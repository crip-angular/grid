!function(i,e){"use strict";e.grid=i.module("crip.grid",["crip.core","crip.grid.templates"])}(angular,window.crip||(window.crip={})),function(i,e){"use strict";e.grid.constant("cripGridEvents",{externallyChanged:"crip-grid-externally-changed",paginationChanged:"crip-grid-pagination-changed",filtersChanged:"crip-grid-filters-changed",dataChanged:"cript-grid-data-changed",sortChanged:"crip-grid-sort-changed"})}(angular,window.crip||(window.crip={})),function(i,e){"use strict";e.grid.constant("cripPaginationConfig",{maxSize:5,boundaryLinks:!0,directionLinks:!0,firstText:"First",previousText:"Previous",nextText:"Next",lastText:"Last"})}(angular,window.crip||(window.crip={})),function(i,e){"use strict";function n(i){function e(i,e){return e.templateUrl||"/crip/grid/per-page.html"}function n(e,n,r,t){e.selected=parseInt(e.cripGridPerPage.pagination.perPage,10)||i.getDefaultPerPageOption(),e.options=e.cripGridPerPage.pagination.pageSizes,e.$watch("selected",function(i){i!==e.cripGridPerPage.pagination.perPage&&(e.cripGridPerPage.pagination.perPage=i)})}return{restrict:"A",templateUrl:e,scope:{cripGridPerPage:"=",cripClass:"@"},replace:!1,transclude:!0,link:n}}e.grid.directive("cripGridPerPage",n),n.$inject=["cripGridConfig"]}(angular,window.crip||(window.crip={})),function(i,e){"use strict";function n(){function i(i,e){return e.templateUrl||"/crip/grid/th.html"}function e(i,e,n,r){i.cripTitle||(i.cripTitle=i.cripText),e.addClass("crip-grid th").find("a").on("click",function(){this.blur()})}return{restrict:"A",templateUrl:i,scope:{cripGridTh:"=",cripText:"@",cripName:"@",cripTitle:"@"},replace:!1,transclude:!0,link:e}}e.grid.directive("cripGridTh",n),n.$inject=[]}(angular,window.crip||(window.crip={})),function(i,e){"use strict";function n(e){function n(i,e){return e.templateUrl||"/crip/grid/pagination.html"}function r(n,r,t,a){function c(i,e){e!=i&&(n.cripGridPagination.totalPages=o(),s())}function o(){var i=n.cripGridPagination.perPage<1?1:Math.ceil(n.cripGridPagination.total/n.cripGridPagination.perPage);return Math.max(i||0,1)}function s(){n.cripGridPagination.page=parseInt(n.cripGridPagination.page,10)||1,n.pages=g(n.cripGridPagination.page,n.cripGridPagination.totalPages,d("maxSize")),n.cripGridPagination.page>n.cripGridPagination.totalPages&&n.selectPage(n.cripGridPagination.totalPages)}function p(i,e,n){return{number:i,text:e,active:n}}function g(e,n,r){var t=[],a=1,c=n,o=i.isDefined(r)&&n>r;o&&(a=Math.ceil(e-r/2),a<Math.floor(r/2)&&(a=1),c=a+r-1,c>=n&&(c=n,a=n-r+1));for(var s=a;c>=s;s++){var g=p(s,s,s==e);t.push(g)}if(o&&r>0){if(a>1){var d=p(a-1,"...",!1);t.unshift(d)}if(n>c){var l=p(c+1,"...",!1);t.push(l)}}return t}function d(n){return i.isDefined(t[n])?t[n]:e[n]}c(0,1),n.pages=g(n.cripGridPagination.page,n.cripGridPagination.totalPages,d("maxSize")),n.selectPage=function(i,e){e&&e.preventDefault(),n.cripGridPagination.page!==i&&i>0&&i<=n.cripGridPagination.totalPages&&(e&&e.target&&e.target.blur(),n.cripGridPagination.page=i)},n.getText=function(i){return n[i+"Text"]||e[i+"Text"]},n.noPrevious=function(){return 1==n.cripGridPagination.page},n.noNext=function(){return n.cripGridPagination.page==n.cripGridPagination.totalPages},n.boundaryLinks=d("boundaryLinks"),n.directionLinks=d("directionLinks"),n.$watch("cripGridPagination.total",c),n.$watch("cripGridPagination.perPage",c),n.$watch("cripGridPagination.page",c)}return{restrict:"A",templateUrl:n,scope:{cripGridPagination:"=",firstText:"@",previousText:"@",nextText:"@",lastText:"@"},replace:!1,transclude:!0,link:r}}e.grid.directive("cripGridPagination",n),n.$inject=["cripPaginationConfig"]}(angular,window.crip||(window.crip={})),function(i,e,n){"use strict";function r(n,r,t,a){function c(c){function d(i){var e="asc"===$.sort.direction?"desc":"asc";i!==$.sort.field&&(e=$.sort.direction),c.scope.$broadcast(a.sortChanged,{field:i,direction:e,name:$.name}),$.sort.direction=e,$.sort.field=i}function l(i){return i===$.sort.field&&"asc"===$.sort.direction}function u(i){return i===$.sort.field&&"desc"===$.sort.direction}function f(i,e){c.scope.$broadcast(a.dataChanged,{data:i,total:e,name:$.name}),$.data=i,$.pagination.total=e,c.scope.$$phase||c.scope.$apply()}function P(e,n){var r=i.copy($.filters),a=o(r),c=t.getRequestMappings(),s={};return n&&i.extend(a,n),s[c.page]=$.pagination.page,s[c.perPage]=$.pagination.perPage,s[c.direction]=$.sort.direction,s[c.order]=$.sort.field,s[c.filters]=i.toJson(a),e&&i.extend(s,e),s}function h(i){s(i)&&!$.loading&&(c.scope.$broadcast(a.filtersChanged,{filters:$.filters,name:$.name}),c.paginate(a.filtersChanged,{event:i,filters:$.filters,grid:$.name}))}function w(i){s(i)&&!$.loading&&($.filters={},h(i))}function m(n,r){r.name===c.name&&i.forEach(r,function(n,r){if("filters"===r){var t=e.keys($[r]),a=e.keys(n),c=t.diff(a);if(c.length>0)for(var o in c)c.hasOwnProperty(o)&&delete $[r][c[o]]}i.isObject(n)?i.forEach(n,function(e,n){i.isString(e)&&($[r][n]=e)}):i.isString(n)&&($[r]=n)})}function G(e,n){g(e,n)&&(i.extend(e,{name:$.name}),c.scope.$broadcast(a.sortChanged,e),c.paginate(a.sortChanged,{"new":e,old:n}))}function x(e,n){p(e,n)&&(i.extend(e,{name:$.name}),c.scope.$broadcast(a.paginationChanged,e),c.paginate(a.paginationChanged,{"new":e,old:n}))}function v(e,n){t.updateOnFilterChange&&!i.equals(e,n)&&h(!0)}if(!i.isDefined(c.scope))throw new Error("cripGrid parameters should contain `scope` property to extend!");if(!(i.isDefined(c.scope.$broadcast)&&i.isFunction(c.scope.$broadcast)&&i.isDefined(c.scope.$watch)&&i.isFunction(c.scope.$watch)))throw new Error("cripGrid parameter `scope` should contain `$broadcast` and `$watch` methods to communicate with other parts of code in core!");if(!i.isDefined(c.paginate)||!i.isFunction(c.paginate))throw new Error("cripGrid parameters should contain `paginate` method to call new page content!");i.isDefined(c.name)||(c.name=r["new"]()),i.extend(c.scope,{grid:{loading:!1,name:c.name,sort:{field:"id",direction:"desc"},pagination:{page:1,total:0,perPage:t.getDefaultPerPageOption(),pageSizes:t.getPerPageOptions()},filters:{},showFilters:!1,data:[],sortBy:d,filter:h,isAscFor:l,isDescFor:u,setPageData:f,clearFilters:w,requestParams:P}});var $=c.scope.grid;c.scope.$on(a.externallyChanged,m),c.scope.$watch("grid.sort",G,!0),c.scope.$watch("grid.filters",v,!0),c.scope.$watch("grid.pagination",x,!0);var C=t.getPlugins()||{};i.isDefined(c.plugins)&&i.extend(C,c.plugins),i.forEach(C,function(i,e){var r=n.get(e);r.extend({scope:c.scope,paginate:c.paginate,name:c.name,plugins:i})}),$.showFilters=!!e.keys($.filters).length||$.showFilters}function o(i){var e=[];for(var n in i)i.hasOwnProperty(n)&&e.push([n,i[n]]);return e}function s(i){return i===!0||"click"===i.type||"submit"===i.type||"keypress"===i.type&&13===i.keyCode}function p(i,e){return i!==e&&(parseInt(i.page)!==parseInt(e.page)||parseInt(i.perPage)!==parseInt(e.perPage))}function g(i,e){return i!==e&&(i.direction!==e.direction||i.field!==e.field)}return{extend:c}}n.grid.factory("cripGrid",r),r.$inject=["$injector","cripStrRandom","cripGridConfig","cripGridEvents"]}(angular,Object,window.crip||(window.crip={})),function(i,e){"use strict";function n(){function e(){return{getPlugins:n,getRequestMappings:t,getPerPageOptions:c,getDefaultPerPageOption:o,updateOnFilterChange:u.updateOnFilterChange}}function n(){return p}function r(e){return p=i.copy(e)}function t(){return g}function a(i,e,n,r,t){return g={page:i||"page",perPage:e||"per-page",direction:n||"direction",order:r||"order",filters:t||"filters"}}function c(){return l}function o(){return d}function s(e){if(i.isArray(e)&&e.length>0)return d=e[0],l=e;throw new Error("per_page_options can be array from integers")}var p={},g=a(),d=10,l=[10,25,50],u=this;i.extend(u,{getPlugins:n,setPlugins:r,getRequestMappings:t,setRequestMappings:a,setPerPageOptions:s,updateOnFilterChange:!1}),this.$get=[e]}e.grid.provider("cripGridConfig",n),n.$inject=[]}(angular,window.crip||(window.crip={})),angular.module("crip.grid.templates",[]).run(["$templateCache",function(i){i.put("/crip/grid/pagination.html",'<ul class="pagination">\r\n    <li ng-if="::boundaryLinks"\r\n        ng-class="{disabled: noPrevious()}"\r\n        class="pagination-first">\r\n        <a href ng-click="selectPage(1, $event)">{{::getText(\'first\')}}</a>\r\n    </li>\r\n\r\n    <li ng-if="::directionLinks"\r\n        ng-class="{disabled: noPrevious()}"\r\n        class="pagination-prev">\r\n        <a href ng-click="selectPage(cripGridPagination.page - 1, $event)">{{::getText(\'previous\')}}</a>\r\n    </li>\r\n\r\n    <li ng-repeat="page in pages"\r\n        ng-class="{active: page.active}"\r\n        class="pagination-page">\r\n        <a href ng-click="selectPage(page.number, $event)">{{page.text}}</a>\r\n    </li>\r\n\r\n    <li ng-if="::directionLinks"\r\n        ng-class="{disabled: noNext()}"\r\n        class="pagination-next">\r\n        <a href ng-click="selectPage(cripGridPagination.page + 1, $event)">{{::getText(\'next\')}}</a>\r\n    </li>\r\n\r\n    <li ng-if="::boundaryLinks"\r\n        ng-class="{disabled: noNext()}"\r\n        class="pagination-last">\r\n        <a href ng-click="selectPage(cripGridPagination.totalPages, $event)">{{::getText(\'last\')}}</a>\r\n    </li>\r\n</ul>'),i.put("/crip/grid/per-page.html",'<span ng-transclude></span>\r\n<select class="c-per-page form-control {{cripClass}}"\r\n        ng-model="selected"\r\n        ng-options="size as size for size in options"></select>'),i.put("/crip/grid/th.html",'<a href title="{{cripTitle}}"\r\n   ng-click="cripGridTh.sortBy(cripName)">\r\n    <i class="crip-icon fa pull-right"\r\n       ng-class="{\'fa-sort-desc\': cripGridTh.isDescFor(cripName),\r\n                  \'fa-sort-asc\': cripGridTh.isAscFor(cripName)}"></i> <span ng-transclude></span>\r\n</a>')}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9zb3VyY2UvZ3JpZC5tb2R1bGUuanMiLCIvc291cmNlL2NvbnN0YW50cy9jcmlwR3JpZEV2ZW50cy5qcyIsIi9zb3VyY2UvY29uc3RhbnRzL2NyaXBQYWdpbmF0aW9uQ29uZmlnLmpzIiwiL3NvdXJjZS9kaXJlY3RpdmVzL2NyaXBHcmlkUGVyUGFnZS5qcyIsIi9zb3VyY2UvZGlyZWN0aXZlcy9jcmlwR3JpZFRoLmpzIiwiL3NvdXJjZS9kaXJlY3RpdmVzL2NyaXB0R3JpZFBhZ2luYXRpb24uanMiLCIvc291cmNlL2ZhY3Rvcmllcy9jcmlwR3JpZC5qcyIsIi9zb3VyY2UvcHJvdmlkZXJzL2NyaXBHcmlkQ29uZmlnLmpzIiwiL3NvdXJjZS90ZW1wbGF0ZXMvdGVtcGxhdGVzLmpzIl0sIm5hbWVzIjpbIm5nIiwiY3JpcCIsImdyaWQiLCJtb2R1bGUiLCJhbmd1bGFyIiwid2luZG93IiwiY29uc3RhbnQiLCJleHRlcm5hbGx5Q2hhbmdlZCIsInBhZ2luYXRpb25DaGFuZ2VkIiwiZmlsdGVyc0NoYW5nZWQiLCJkYXRhQ2hhbmdlZCIsInNvcnRDaGFuZ2VkIiwibWF4U2l6ZSIsImJvdW5kYXJ5TGlua3MiLCJkaXJlY3Rpb25MaW5rcyIsImZpcnN0VGV4dCIsInByZXZpb3VzVGV4dCIsIm5leHRUZXh0IiwibGFzdFRleHQiLCJjcmlwR3JpZFBlclBhZ2UiLCJjcmlwR3JpZENvbmZpZyIsInRlbXBsYXRlVXJsIiwiZWxlbWVudCIsImF0dHJzIiwibGluayIsInNjb3BlIiwiY3RybCIsInNlbGVjdGVkIiwicGFyc2VJbnQiLCJwYWdpbmF0aW9uIiwicGVyUGFnZSIsImdldERlZmF1bHRQZXJQYWdlT3B0aW9uIiwib3B0aW9ucyIsInBhZ2VTaXplcyIsIiR3YXRjaCIsIm4iLCJyZXN0cmljdCIsImNyaXBDbGFzcyIsInJlcGxhY2UiLCJ0cmFuc2NsdWRlIiwiZGlyZWN0aXZlIiwiJGluamVjdCIsImNyaXBHcmlkVGgiLCJjcmlwVGl0bGUiLCJjcmlwVGV4dCIsImFkZENsYXNzIiwiZmluZCIsIm9uIiwidGhpcyIsImJsdXIiLCJjcmlwTmFtZSIsImNyaXBHcmlkUGFnaW5hdGlvbiIsImNyaXBQYWdpbmF0aW9uQ29uZmlnIiwib25QYWdpbmdDaGFuZ2UiLCJvIiwidG90YWxQYWdlcyIsImNhbGN1bGF0ZVRvdGFsUGFnZXMiLCJ1cGRhdGVQYWdlIiwiTWF0aCIsImNlaWwiLCJ0b3RhbCIsIm1heCIsInBhZ2UiLCJwYWdlcyIsImdldFBhZ2VzIiwiYXR0ck9yQ29uZmlnIiwic2VsZWN0UGFnZSIsIm1ha2VQYWdlIiwibnVtYmVyIiwidGV4dCIsImlzQWN0aXZlIiwiYWN0aXZlIiwiY3VycmVudFBhZ2UiLCJzdGFydFBhZ2UiLCJlbmRQYWdlIiwiaXNNYXhTaXplZCIsImlzRGVmaW5lZCIsImZsb29yIiwicHVzaCIsInByZXZpb3VzUGFnZVNldCIsInVuc2hpZnQiLCJuZXh0UGFnZVNldCIsImtleSIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInRhcmdldCIsImdldFRleHQiLCJub1ByZXZpb3VzIiwibm9OZXh0IiwiT2JqZWN0IiwiY3JpcEdyaWQiLCIkaW5qZWN0b3IiLCJybmQiLCJldmVudHMiLCJleHRlbmQiLCJwYXJhbXMiLCJzb3J0QnkiLCJmaWVsZCIsIm5ld19kaXJlY3Rpb24iLCJzb3J0IiwiZGlyZWN0aW9uIiwiJGJyb2FkY2FzdCIsIm5hbWUiLCJpc0FzY0ZvciIsImlzRGVzY0ZvciIsInNldFBhZ2VEYXRhIiwiZGF0YSIsIiQkcGhhc2UiLCIkYXBwbHkiLCJyZXF1ZXN0UGFyYW1zIiwic3RhdGljUGFyYW1zIiwiY3VzdG9tRmlsdGVycyIsImZpbHRlcl92YWx1ZXMiLCJjb3B5IiwiZmlsdGVycyIsInByZXBhcmVGaWx0ZXJzIiwibWFwcGluZ3MiLCJnZXRSZXF1ZXN0TWFwcGluZ3MiLCJ1cmxfcGFyYW1zIiwib3JkZXIiLCJ0b0pzb24iLCJmaWx0ZXIiLCJpc1N1Ym1pdHRhYmxlRXZlbnQiLCJsb2FkaW5nIiwicGFnaW5hdGUiLCJldmVudCIsImNsZWFyRmlsdGVycyIsIl9vbkdyaWRFeHRlcm5hbGx5Q2hhbmdlZCIsImZvckVhY2giLCJ2YWx1ZSIsImtleXMiLCJuZXdGaWx0ZXJzIiwiZGlmZiIsImxlbmd0aCIsImRlbGV0ZWQiLCJoYXNPd25Qcm9wZXJ0eSIsImlzT2JqZWN0IiwicHJvcCIsImkiLCJpc1N0cmluZyIsIl93YXRjaEdyaWRTb3J0IiwiaXNPcmRlckNoYW5nZWQiLCJuZXciLCJvbGQiLCJfd2F0Y2hHcmlkUGFnaW5hdGlvbiIsImlzUGFnZUNoYW5nZWQiLCJfd2F0Y2hHcmlkRmlsdGVycyIsInVwZGF0ZU9uRmlsdGVyQ2hhbmdlIiwiZXF1YWxzIiwiRXJyb3IiLCJpc0Z1bmN0aW9uIiwiZ2V0UGVyUGFnZU9wdGlvbnMiLCJzaG93RmlsdGVycyIsIiRvbiIsInBsdWdpbnMiLCJnZXRQbHVnaW5zIiwicGx1Z2luX3BhcmFtcyIsInBsdWdpbiIsIlBsdWdpbkluc3RhbmNlIiwiZ2V0IiwicmV0IiwidHlwZSIsImtleUNvZGUiLCJmYWN0b3J5IiwiJGdldCIsInNldFBsdWdpbnMiLCJuZXdQbHVnaW5Db25maWciLCJyZXF1ZXN0X3Byb3BzIiwic2V0UmVxdWVzdE1hcHBpbmdzIiwicGVyX3BhZ2UiLCJkZWZhdWx0X3Blcl9wYWdlIiwic2V0UGVyUGFnZU9wdGlvbnMiLCJwZXJfcGFnZV9vcHRpb25zIiwiaXNBcnJheSIsInByb3ZpZGVyIiwicnVuIiwiJHRlbXBsYXRlQ2FjaGUiLCJwdXQiXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBQ0EsWUFFQUEsR0FBQUMsS0FBQUYsRUFBQUcsT0FBQSxhQUNBLFlBQ0EseUJBR0FDLFFBQUFDLE9BQUFKLE9BQUFJLE9BQUFKLFVDUkEsU0FBQUcsRUFBQUgsR0FDQSxZQUVBQSxHQUFBQyxLQUNBSSxTQUFBLGtCQUNBQyxrQkFBQSwrQkFDQUMsa0JBQUEsK0JBQ0FDLGVBQUEsNEJBQ0FDLFlBQUEsMEJBQ0FDLFlBQUEsNEJBR0FQLFFBQUFDLE9BQUFKLE9BQUFJLE9BQUFKLFVDWkEsU0FBQUQsRUFB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QUFBRCxHQUdBLFFBQUFXLEdBQUFDLEdBQ0EsTUFBQVosR0FBQTFKLEVBQUFpSCxLQUFBcUQsR0FHQSxRQUFBakQsS0FDQSxNQUFBa0QsR0FHQSxRQUFBQyxHQUFBMUcsRUFBQWhDLEVBQUFzRSxFQUFBbUIsRUFBQUwsR0FDQSxNQUFBcUQsSUFDQXpHLEtBQUFBLEdBQUEsT0FDQWhDLFFBQUFBLEdBQUEsV0FDQXNFLFVBQUFBLEdBQUEsWUFDQW1CLE1BQUFBLEdBQUEsUUFDQUwsUUFBQUEsR0FBQSxXQUlBLFFBQUFxQyxLQUNBLE1BQUFrQixHQUdBLFFBQUExSSxLQUNBLE1BQUEySSxHQUdBLFFBQUFDLEdBQUFDLEdBQ0EsR0FBQTVLLEVBQUE2SyxRQUFBRCxJQUFBQSxFQUFBdkMsT0FBQSxFQUVBLE1BREFxQyxHQUFBRSxFQUFBLEdBQ0FILEVBQUFHLENBRUEsTUFBQSxJQUFBdkIsT0FBQSwrQ0EvREEsR0FBQUssTUFDQWEsRUFBQUMsSUFDQUUsRUFBQSxHQUNBRCxHQUFBLEdBQUEsR0FBQSxJQUVBaEosRUFBQXVCLElBRUFoRCxHQUFBOEYsT0FBQXJFLEdBQ0FrSSxXQUFBQSxFQUNBVSxXQUFBQSxFQUNBaEQsbUJBQUFBLEVBQ0FtRCxtQkFBQUEsRUFDQUcsa0JBQUFBLEVBQ0F4QixzQkFBQSxJQUdBbkcsS0FBQW9ILE1BQUFBLEdBdEJBbkssRUFBQUMsS0FDQTRLLFNBQUEsaUJBQUExSixHQUVBQSxFQUFBcUIsWUFxRUFyQyxRQUFBQyxPQUFBSixPQUFBSSxPQUFBSixVQzNFQUcsUUFBQUQsT0FBQSwwQkFBQTRLLEtBQUEsaUJBQUEsU0FBQUMsR0FBQUEsRUFBQUMsSUFBQSw2QkFBQSxrcUNBQ0FELEVBQUFDLElBQUEsMkJBQUEsMExBQ0FELEVBQUFDLElBQUEscUJBQUEiLCJmaWxlIjoiY3JpcC1ncmlkLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAobmcsIGNyaXApIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBjcmlwLmdyaWQgPSBuZy5tb2R1bGUoJ2NyaXAuZ3JpZCcsIFtcclxuICAgICAgICAnY3JpcC5jb3JlJyxcclxuICAgICAgICAnY3JpcC5ncmlkLnRlbXBsYXRlcydcclxuICAgIF0pO1xyXG5cclxufSkoYW5ndWxhciwgd2luZG93LmNyaXAgfHwgKHdpbmRvdy5jcmlwID0ge30pKTsiLCIoZnVuY3Rpb24gKGFuZ3VsYXIsIGNyaXApIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBjcmlwLmdyaWRcclxuICAgICAgICAuY29uc3RhbnQoJ2NyaXBHcmlkRXZlbnRzJywge1xyXG4gICAgICAgICAgICBleHRlcm5hbGx5Q2hhbmdlZDogJ2NyaXAtZ3JpZC1leHRlcm5hbGx5LWNoYW5nZWQnLFxyXG4gICAgICAgICAgICBwYWdpbmF0aW9uQ2hhbmdlZDogJ2NyaXAtZ3JpZC1wYWdpbmF0aW9uLWNoYW5nZWQnLFxyXG4gICAgICAgICAgICBmaWx0ZXJzQ2hhbmdlZDogJ2NyaXAtZ3JpZC1maWx0ZXJzLWNoYW5nZWQnLFxyXG4gICAgICAgICAgICBkYXRhQ2hhbmdlZDogJ2NyaXB0LWdyaWQtZGF0YS1jaGFuZ2VkJyxcclxuICAgICAgICAgICAgc29ydENoYW5nZWQ6ICdjcmlwLWdyaWQtc29ydC1jaGFuZ2VkJ1xyXG4gICAgICAgIH0pO1xyXG5cclxufSkoYW5ndWxhciwgd2luZG93LmNyaXAgfHwgKHdpbmRvdy5jcmlwID0ge30pKTsiLCIoZnVuY3Rpb24gKG5nLCBjcmlwKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgY3JpcC5ncmlkXHJcbiAgICAgICAgLmNvbnN0YW50KCdjcmlwUGFnaW5hdGlvbkNvbmZpZycsIHtcclxuICAgICAgICAgICAgbWF4U2l6ZTogNSxcclxuICAgICAgICAgICAgYm91bmRhcnlMaW5rczogdHJ1ZSxcclxuICAgICAgICAgICAgZGlyZWN0aW9uTGlua3M6IHRydWUsXHJcbiAgICAgICAgICAgIGZpcnN0VGV4dDogJ0ZpcnN0JyxcclxuICAgICAgICAgICAgcHJldmlvdXNUZXh0OiAnUHJldmlvdXMnLFxyXG4gICAgICAgICAgICBuZXh0VGV4dDogJ05leHQnLFxyXG4gICAgICAgICAgICBsYXN0VGV4dDogJ0xhc3QnXHJcbiAgICAgICAgfSk7XHJcblxyXG59KShhbmd1bGFyLCB3aW5kb3cuY3JpcCB8fCAod2luZG93LmNyaXAgPSB7fSkpOyIsIihmdW5jdGlvbiAobmcsIGNyaXApIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBjcmlwLmdyaWRcclxuICAgICAgICAuZGlyZWN0aXZlKCdjcmlwR3JpZFBlclBhZ2UnLCBjcmlwR3JpZFBlclBhZ2UpO1xyXG5cclxuICAgIGNyaXBHcmlkUGVyUGFnZS4kaW5qZWN0ID0gWydjcmlwR3JpZENvbmZpZyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNyaXBHcmlkUGVyUGFnZShjcmlwR3JpZENvbmZpZykge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiB0ZW1wbGF0ZVVybCxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIGNyaXBHcmlkUGVyUGFnZTogJz0nLFxyXG4gICAgICAgICAgICAgICAgY3JpcENsYXNzOiAnQCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgcmVwbGFjZTogZmFsc2UsXHJcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6IHRydWUsXHJcbiAgICAgICAgICAgIGxpbms6IGxpbmtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiB0ZW1wbGF0ZVVybChlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICByZXR1cm4gYXR0cnMudGVtcGxhdGVVcmwgfHwgJy9jcmlwL2dyaWQvcGVyLXBhZ2UuaHRtbCc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycywgY3RybCkge1xyXG4gICAgICAgICAgICBzY29wZS5zZWxlY3RlZCA9IHBhcnNlSW50KHNjb3BlLmNyaXBHcmlkUGVyUGFnZS5wYWdpbmF0aW9uLnBlclBhZ2UsIDEwKVxyXG4gICAgICAgICAgICAgICAgfHwgY3JpcEdyaWRDb25maWcuZ2V0RGVmYXVsdFBlclBhZ2VPcHRpb24oKTtcclxuICAgICAgICAgICAgc2NvcGUub3B0aW9ucyA9IHNjb3BlLmNyaXBHcmlkUGVyUGFnZS5wYWdpbmF0aW9uLnBhZ2VTaXplcztcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnc2VsZWN0ZWQnLCBmdW5jdGlvbiAobikge1xyXG4gICAgICAgICAgICAgICAgaWYgKG4gIT09IHNjb3BlLmNyaXBHcmlkUGVyUGFnZS5wYWdpbmF0aW9uLnBlclBhZ2UpXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuY3JpcEdyaWRQZXJQYWdlLnBhZ2luYXRpb24ucGVyUGFnZSA9IG47XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG59KShhbmd1bGFyLCB3aW5kb3cuY3JpcCB8fCAod2luZG93LmNyaXAgPSB7fSkpOyIsIihmdW5jdGlvbiAobmcsIGNyaXApIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBjcmlwLmdyaWRcclxuICAgICAgICAuZGlyZWN0aXZlKCdjcmlwR3JpZFRoJywgY3JpcEdyaWRUaCk7XHJcblxyXG4gICAgY3JpcEdyaWRUaC4kaW5qZWN0ID0gW107XHJcblxyXG4gICAgZnVuY3Rpb24gY3JpcEdyaWRUaCgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogdGVtcGxhdGVVcmwsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBjcmlwR3JpZFRoOiAnPScsXHJcbiAgICAgICAgICAgICAgICBjcmlwVGV4dDogJ0AnLFxyXG4gICAgICAgICAgICAgICAgY3JpcE5hbWU6ICdAJyxcclxuICAgICAgICAgICAgICAgIGNyaXBUaXRsZTogJ0AnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IGZhbHNlLFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxyXG4gICAgICAgICAgICBsaW5rOiBsaW5rXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdGVtcGxhdGVVcmwoZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGF0dHJzLnRlbXBsYXRlVXJsIHx8ICcvY3JpcC9ncmlkL3RoLmh0bWwnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmwpIHtcclxuICAgICAgICAgICAgaWYgKCFzY29wZS5jcmlwVGl0bGUpXHJcbiAgICAgICAgICAgICAgICBzY29wZS5jcmlwVGl0bGUgPSBzY29wZS5jcmlwVGV4dDtcclxuXHJcbiAgICAgICAgICAgIGVsZW1lbnRcclxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcygnY3JpcC1ncmlkIHRoJylcclxuICAgICAgICAgICAgICAgIC5maW5kKCdhJylcclxuICAgICAgICAgICAgICAgIC5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ibHVyKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxufSkoYW5ndWxhciwgd2luZG93LmNyaXAgfHwgKHdpbmRvdy5jcmlwID0ge30pKTsiLCIoZnVuY3Rpb24gKG5nLCBjcmlwKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgY3JpcC5ncmlkXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnY3JpcEdyaWRQYWdpbmF0aW9uJywgY3JpcEdyaWRQYWdpbmF0aW9uKTtcclxuXHJcbiAgICBjcmlwR3JpZFBhZ2luYXRpb24uJGluamVjdCA9IFsnY3JpcFBhZ2luYXRpb25Db25maWcnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBjcmlwR3JpZFBhZ2luYXRpb24oY3JpcFBhZ2luYXRpb25Db25maWcpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogdGVtcGxhdGVVcmwsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBjcmlwR3JpZFBhZ2luYXRpb246ICc9JyxcclxuICAgICAgICAgICAgICAgIGZpcnN0VGV4dDogJ0AnLFxyXG4gICAgICAgICAgICAgICAgcHJldmlvdXNUZXh0OiAnQCcsXHJcbiAgICAgICAgICAgICAgICBuZXh0VGV4dDogJ0AnLFxyXG4gICAgICAgICAgICAgICAgbGFzdFRleHQ6ICdAJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICByZXBsYWNlOiBmYWxzZSxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAgICAgbGluazogbGlua1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHRlbXBsYXRlVXJsKGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhdHRycy50ZW1wbGF0ZVVybCB8fCAnL2NyaXAvZ3JpZC9wYWdpbmF0aW9uLmh0bWwnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmwpIHtcclxuICAgICAgICAgICAgb25QYWdpbmdDaGFuZ2UoMCwgMSk7XHJcbiAgICAgICAgICAgIHNjb3BlLnBhZ2VzID0gZ2V0UGFnZXMoc2NvcGUuY3JpcEdyaWRQYWdpbmF0aW9uLnBhZ2UsIHNjb3BlLmNyaXBHcmlkUGFnaW5hdGlvbi50b3RhbFBhZ2VzLCBhdHRyT3JDb25maWcoJ21heFNpemUnKSk7XHJcblxyXG4gICAgICAgICAgICBzY29wZS5zZWxlY3RQYWdlID0gZnVuY3Rpb24gKHBhZ2UsIGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5jcmlwR3JpZFBhZ2luYXRpb24ucGFnZSAhPT0gcGFnZSAmJiBwYWdlID4gMCAmJiBwYWdlIDw9IHNjb3BlLmNyaXBHcmlkUGFnaW5hdGlvbi50b3RhbFBhZ2VzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUgJiYgZS50YXJnZXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZS50YXJnZXQuYmx1cigpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5jcmlwR3JpZFBhZ2luYXRpb24ucGFnZSA9IHBhZ2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBzY29wZS5nZXRUZXh0ID0gZnVuY3Rpb24gKGtleSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjb3BlW2tleSArICdUZXh0J10gfHwgY3JpcFBhZ2luYXRpb25Db25maWdba2V5ICsgJ1RleHQnXTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLm5vUHJldmlvdXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc2NvcGUuY3JpcEdyaWRQYWdpbmF0aW9uLnBhZ2UgPT0gMTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLm5vTmV4dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzY29wZS5jcmlwR3JpZFBhZ2luYXRpb24ucGFnZSA9PSBzY29wZS5jcmlwR3JpZFBhZ2luYXRpb24udG90YWxQYWdlcztcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLmJvdW5kYXJ5TGlua3MgPSBhdHRyT3JDb25maWcoJ2JvdW5kYXJ5TGlua3MnKTtcclxuICAgICAgICAgICAgc2NvcGUuZGlyZWN0aW9uTGlua3MgPSBhdHRyT3JDb25maWcoJ2RpcmVjdGlvbkxpbmtzJyk7XHJcblxyXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ2NyaXBHcmlkUGFnaW5hdGlvbi50b3RhbCcsIG9uUGFnaW5nQ2hhbmdlKTtcclxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdjcmlwR3JpZFBhZ2luYXRpb24ucGVyUGFnZScsIG9uUGFnaW5nQ2hhbmdlKTtcclxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdjcmlwR3JpZFBhZ2luYXRpb24ucGFnZScsIG9uUGFnaW5nQ2hhbmdlKTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIG9uUGFnaW5nQ2hhbmdlKG4sIG8pIHtcclxuICAgICAgICAgICAgICAgIGlmIChvICE9IG4pIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5jcmlwR3JpZFBhZ2luYXRpb24udG90YWxQYWdlcyA9IGNhbGN1bGF0ZVRvdGFsUGFnZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVQYWdlKClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gY2FsY3VsYXRlVG90YWxQYWdlcygpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0b3RhbFBhZ2VzID0gc2NvcGUuY3JpcEdyaWRQYWdpbmF0aW9uLnBlclBhZ2UgPCAxID9cclxuICAgICAgICAgICAgICAgICAgICAxIDogTWF0aC5jZWlsKHNjb3BlLmNyaXBHcmlkUGFnaW5hdGlvbi50b3RhbCAvIHNjb3BlLmNyaXBHcmlkUGFnaW5hdGlvbi5wZXJQYWdlKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLm1heCh0b3RhbFBhZ2VzIHx8IDAsIDEpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVQYWdlKCkge1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuY3JpcEdyaWRQYWdpbmF0aW9uLnBhZ2UgPSBwYXJzZUludChzY29wZS5jcmlwR3JpZFBhZ2luYXRpb24ucGFnZSwgMTApIHx8IDE7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5wYWdlcyA9IGdldFBhZ2VzKHNjb3BlLmNyaXBHcmlkUGFnaW5hdGlvbi5wYWdlLCBzY29wZS5jcmlwR3JpZFBhZ2luYXRpb24udG90YWxQYWdlcywgYXR0ck9yQ29uZmlnKCdtYXhTaXplJykpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmNyaXBHcmlkUGFnaW5hdGlvbi5wYWdlID4gc2NvcGUuY3JpcEdyaWRQYWdpbmF0aW9uLnRvdGFsUGFnZXMpXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2VsZWN0UGFnZShzY29wZS5jcmlwR3JpZFBhZ2luYXRpb24udG90YWxQYWdlcyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIENyZWF0ZSBwYWdlIG9iamVjdCB1c2VkIGluIHRlbXBsYXRlXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIG1ha2VQYWdlKG51bWJlciwgdGV4dCwgaXNBY3RpdmUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiBudW1iZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dCxcclxuICAgICAgICAgICAgICAgICAgICBhY3RpdmU6IGlzQWN0aXZlXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRQYWdlcyhjdXJyZW50UGFnZSwgdG90YWxQYWdlcywgbWF4U2l6ZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBhZ2VzID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gRGVmYXVsdCBwYWdlIGxpbWl0c1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0YXJ0UGFnZSA9IDEsIGVuZFBhZ2UgPSB0b3RhbFBhZ2VzO1xyXG4gICAgICAgICAgICAgICAgdmFyIGlzTWF4U2l6ZWQgPSBuZy5pc0RlZmluZWQobWF4U2l6ZSkgJiYgbWF4U2l6ZSA8IHRvdGFsUGFnZXM7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gcmVjb21wdXRlIGlmIG1heFNpemVcclxuICAgICAgICAgICAgICAgIGlmIChpc01heFNpemVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRQYWdlID0gTWF0aC5jZWlsKGN1cnJlbnRQYWdlIC0gKG1heFNpemUgLyAyKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGFydFBhZ2UgPCBNYXRoLmZsb29yKG1heFNpemUgLyAyKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRQYWdlID0gMTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZW5kUGFnZSA9IHN0YXJ0UGFnZSArIG1heFNpemUgLSAxO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZW5kUGFnZSA+PSB0b3RhbFBhZ2VzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZFBhZ2UgPSB0b3RhbFBhZ2VzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydFBhZ2UgPSB0b3RhbFBhZ2VzIC0gbWF4U2l6ZSArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIEFkZCBwYWdlIG51bWJlciBsaW5rc1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgbnVtYmVyID0gc3RhcnRQYWdlOyBudW1iZXIgPD0gZW5kUGFnZTsgbnVtYmVyKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcGFnZSA9IG1ha2VQYWdlKG51bWJlciwgbnVtYmVyLCBudW1iZXIgPT0gY3VycmVudFBhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VzLnB1c2gocGFnZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQWRkIGxpbmtzIHRvIG1vdmUgYmV0d2VlbiBwYWdlIHNldHNcclxuICAgICAgICAgICAgICAgIGlmIChpc01heFNpemVkICYmIG1heFNpemUgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXJ0UGFnZSA+IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9uZWVkIGVsbGlwc2lzIGZvciBhbGwgb3B0aW9ucyB1bmxlc3MgcmFuZ2UgaXMgdG9vIGNsb3NlIHRvIGJlZ2lubmluZ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJldmlvdXNQYWdlU2V0ID0gbWFrZVBhZ2Uoc3RhcnRQYWdlIC0gMSwgJy4uLicsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFnZXMudW5zaGlmdChwcmV2aW91c1BhZ2VTZXQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVuZFBhZ2UgPCB0b3RhbFBhZ2VzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vbmVlZCBlbGxpcHNpcyBmb3IgYWxsIG9wdGlvbnMgdW5sZXNzIHJhbmdlIGlzIHRvbyBjbG9zZSB0byBlbmRcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5leHRQYWdlU2V0ID0gbWFrZVBhZ2UoZW5kUGFnZSArIDEsICcuLi4nLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VzLnB1c2gobmV4dFBhZ2VTZXQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFnZXM7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGF0dHJPckNvbmZpZyhrZXkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZy5pc0RlZmluZWQoYXR0cnNba2V5XSkgPyBhdHRyc1trZXldIDogY3JpcFBhZ2luYXRpb25Db25maWdba2V5XTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG59KShhbmd1bGFyLCB3aW5kb3cuY3JpcCB8fCAod2luZG93LmNyaXAgPSB7fSkpOyIsIihmdW5jdGlvbiAobmcsIE9iamVjdCwgY3JpcCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGNyaXAuZ3JpZFxyXG4gICAgICAgIC5mYWN0b3J5KCdjcmlwR3JpZCcsIGNyaXBHcmlkKTtcclxuXHJcbiAgICBjcmlwR3JpZC4kaW5qZWN0ID0gWyckaW5qZWN0b3InLCAnY3JpcFN0clJhbmRvbScsICdjcmlwR3JpZENvbmZpZycsICdjcmlwR3JpZEV2ZW50cyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNyaXBHcmlkKCRpbmplY3Rvciwgcm5kLCBjcmlwR3JpZENvbmZpZywgZXZlbnRzKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZXh0ZW5kOiBleHRlbmRcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBleHRlbmQocGFyYW1zKSB7XHJcbiAgICAgICAgICAgIGlmICghbmcuaXNEZWZpbmVkKHBhcmFtcy5zY29wZSkpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignY3JpcEdyaWQgcGFyYW1ldGVycyBzaG91bGQgY29udGFpbiBgc2NvcGVgIHByb3BlcnR5IHRvIGV4dGVuZCEnKVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIW5nLmlzRGVmaW5lZChwYXJhbXMuc2NvcGUuJGJyb2FkY2FzdCkgfHwgIW5nLmlzRnVuY3Rpb24ocGFyYW1zLnNjb3BlLiRicm9hZGNhc3QpXHJcbiAgICAgICAgICAgICAgICB8fCAhbmcuaXNEZWZpbmVkKHBhcmFtcy5zY29wZS4kd2F0Y2gpIHx8ICFuZy5pc0Z1bmN0aW9uKHBhcmFtcy5zY29wZS4kd2F0Y2gpKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NyaXBHcmlkIHBhcmFtZXRlciBgc2NvcGVgIHNob3VsZCBjb250YWluIGAkYnJvYWRjYXN0YCBhbmQgYCR3YXRjaGAgbWV0aG9kcyB0byBjb21tdW5pY2F0ZSB3aXRoIG90aGVyIHBhcnRzIG9mIGNvZGUgaW4gY29yZSEnKVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIW5nLmlzRGVmaW5lZChwYXJhbXMucGFnaW5hdGUpIHx8ICFuZy5pc0Z1bmN0aW9uKHBhcmFtcy5wYWdpbmF0ZSkpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignY3JpcEdyaWQgcGFyYW1ldGVycyBzaG91bGQgY29udGFpbiBgcGFnaW5hdGVgIG1ldGhvZCB0byBjYWxsIG5ldyBwYWdlIGNvbnRlbnQhJylcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFuZy5pc0RlZmluZWQocGFyYW1zLm5hbWUpKSB7XHJcbiAgICAgICAgICAgICAgICBwYXJhbXMubmFtZSA9IHJuZC5uZXcoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbmcuZXh0ZW5kKHBhcmFtcy5zY29wZSwge1xyXG4gICAgICAgICAgICAgICAgLy8gZ3JpZCBpbml0aWFsIGRhdGFcclxuICAgICAgICAgICAgICAgIGdyaWQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBsb2FkaW5nOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAvLyB1bmlxdWUgaWRlbnRpZmllciBmb3IgZ3JpZFxyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHBhcmFtcy5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGdyaWQgb3JkZXJpbmcgZGF0YVxyXG4gICAgICAgICAgICAgICAgICAgIHNvcnQ6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQ6ICdpZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogJ2Rlc2MnXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAvLyBncmlkIHBhZ2luYXRpb24gZGF0YVxyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFnZTogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBlclBhZ2U6IGNyaXBHcmlkQ29uZmlnLmdldERlZmF1bHRQZXJQYWdlT3B0aW9uKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplczogY3JpcEdyaWRDb25maWcuZ2V0UGVyUGFnZU9wdGlvbnMoKVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZ3JpZCBmaWx0ZXJzXHJcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyczoge30sXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZGlzcGxheSBncmlkIGZpbHRlcnNcclxuICAgICAgICAgICAgICAgICAgICBzaG93RmlsdGVyczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWxsIGN1cnJlbnQgZ3JpZCBkYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogW10sXHJcbiAgICAgICAgICAgICAgICAgICAgc29ydEJ5OiBzb3J0QnksXHJcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiBmaWx0ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgaXNBc2NGb3I6IGlzQXNjRm9yLFxyXG4gICAgICAgICAgICAgICAgICAgIGlzRGVzY0ZvcjogaXNEZXNjRm9yLFxyXG4gICAgICAgICAgICAgICAgICAgIHNldFBhZ2VEYXRhOiBzZXRQYWdlRGF0YSxcclxuICAgICAgICAgICAgICAgICAgICBjbGVhckZpbHRlcnM6IGNsZWFyRmlsdGVycyxcclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0UGFyYW1zOiByZXF1ZXN0UGFyYW1zXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdmFyIGdyaWQgPSBwYXJhbXMuc2NvcGUuZ3JpZDtcclxuXHJcbiAgICAgICAgICAgIHBhcmFtcy5zY29wZS4kb24oZXZlbnRzLmV4dGVybmFsbHlDaGFuZ2VkLCBfb25HcmlkRXh0ZXJuYWxseUNoYW5nZWQpO1xyXG4gICAgICAgICAgICBwYXJhbXMuc2NvcGUuJHdhdGNoKCdncmlkLnNvcnQnLCBfd2F0Y2hHcmlkU29ydCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIHBhcmFtcy5zY29wZS4kd2F0Y2goJ2dyaWQuZmlsdGVycycsIF93YXRjaEdyaWRGaWx0ZXJzLCB0cnVlKTtcclxuICAgICAgICAgICAgcGFyYW1zLnNjb3BlLiR3YXRjaCgnZ3JpZC5wYWdpbmF0aW9uJywgX3dhdGNoR3JpZFBhZ2luYXRpb24sIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgdmFyIHBsdWdpbnMgPSBjcmlwR3JpZENvbmZpZy5nZXRQbHVnaW5zKCkgfHwge307XHJcbiAgICAgICAgICAgIGlmIChuZy5pc0RlZmluZWQocGFyYW1zLnBsdWdpbnMpKSB7XHJcbiAgICAgICAgICAgICAgICBuZy5leHRlbmQocGx1Z2lucywgcGFyYW1zLnBsdWdpbnMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vJGxvZy5sb2coJ2NyaXBHcmlkIC0+IHN0YXJ0ZWQnLCB7cGx1Z2luczogcGx1Z2lucywgZ3JpZDogcGFyYW1zLnNjb3BlLmdyaWR9KTtcclxuICAgICAgICAgICAgbmcuZm9yRWFjaChwbHVnaW5zLCBmdW5jdGlvbiAocGx1Z2luX3BhcmFtcywgcGx1Z2luKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgUGx1Z2luSW5zdGFuY2UgPSAkaW5qZWN0b3IuZ2V0KHBsdWdpbik7XHJcbiAgICAgICAgICAgICAgICAvLyBlbmFibGUgcGx1Z2lucyB7bmFtZSwgc2NvcGUsIHBhZ2luYXRlLCBwbHVnaW5zfVxyXG4gICAgICAgICAgICAgICAgUGx1Z2luSW5zdGFuY2UuZXh0ZW5kKHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZTogcGFyYW1zLnNjb3BlLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRlOiBwYXJhbXMucGFnaW5hdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogcGFyYW1zLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgcGx1Z2luczogcGx1Z2luX3BhcmFtc1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gaWYgaGFzIGZpbHRlcnMgYWZ0ZXIgaW5pdCwgc2hvdyBmaWx0ZXJzIGFyZWFcclxuICAgICAgICAgICAgZ3JpZC5zaG93RmlsdGVycyA9ICghIU9iamVjdC5rZXlzKGdyaWQuZmlsdGVycykubGVuZ3RoKSB8fCBncmlkLnNob3dGaWx0ZXJzO1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gc29ydEJ5KGZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbmV3X2RpcmVjdGlvbiA9IGdyaWQuc29ydC5kaXJlY3Rpb24gPT09ICdhc2MnID8gJ2Rlc2MnIDogJ2FzYyc7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmllbGQgIT09IGdyaWQuc29ydC5maWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld19kaXJlY3Rpb24gPSBncmlkLnNvcnQuZGlyZWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIGZpcmUgZXZlbnQgb24gc29ydCBjaGFuZ2VcclxuICAgICAgICAgICAgICAgIHBhcmFtcy5zY29wZS4kYnJvYWRjYXN0KGV2ZW50cy5zb3J0Q2hhbmdlZCwge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBmaWVsZCxcclxuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246IG5ld19kaXJlY3Rpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogZ3JpZC5uYW1lXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBncmlkLnNvcnQuZGlyZWN0aW9uID0gbmV3X2RpcmVjdGlvbjtcclxuICAgICAgICAgICAgICAgIGdyaWQuc29ydC5maWVsZCA9IGZpZWxkO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBpc0FzY0ZvcihmaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkID09PSBncmlkLnNvcnQuZmllbGQgJiYgZ3JpZC5zb3J0LmRpcmVjdGlvbiA9PT0gJ2FzYyc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGlzRGVzY0ZvcihmaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkID09PSBncmlkLnNvcnQuZmllbGQgJiYgZ3JpZC5zb3J0LmRpcmVjdGlvbiA9PT0gJ2Rlc2MnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBzZXRQYWdlRGF0YShkYXRhLCB0b3RhbCkge1xyXG4gICAgICAgICAgICAgICAgLy8gZmlyZSBldmVudCBvbiBwYWdlIGRhdGEgY2hhbmdlXHJcbiAgICAgICAgICAgICAgICBwYXJhbXMuc2NvcGUuJGJyb2FkY2FzdChldmVudHMuZGF0YUNoYW5nZWQsIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0b3RhbCxcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBncmlkLm5hbWVcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGdyaWQuZGF0YSA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICBncmlkLnBhZ2luYXRpb24udG90YWwgPSB0b3RhbDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXBhcmFtcy5zY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLnNjb3BlLiRhcHBseSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBjdXN0b21GaWx0ZXJzIHdpbGwgYmUgYXBwZW5kZWQgdG8gZmlsdGVycyBwYXJhbWV0ZXJcclxuICAgICAgICAgICAgLy8gc3RhdGljUGFyYW1zIHdpbGwgYmUgcGFzc2VkIGFzIGdldCBwYXJhbWV0ZXJzIHRvIHJlcXVlc3RcclxuICAgICAgICAgICAgZnVuY3Rpb24gcmVxdWVzdFBhcmFtcyhzdGF0aWNQYXJhbXMsIGN1c3RvbUZpbHRlcnMpIHtcclxuICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJfdmFsdWVzID0gbmcuY29weShncmlkLmZpbHRlcnMpLFxyXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcnMgPSBwcmVwYXJlRmlsdGVycyhmaWx0ZXJfdmFsdWVzKSxcclxuICAgICAgICAgICAgICAgICAgICBtYXBwaW5ncyA9IGNyaXBHcmlkQ29uZmlnLmdldFJlcXVlc3RNYXBwaW5ncygpLFxyXG4gICAgICAgICAgICAgICAgICAgIHVybF9wYXJhbXMgPSB7fTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoY3VzdG9tRmlsdGVycykge1xyXG4gICAgICAgICAgICAgICAgICAgIG5nLmV4dGVuZChmaWx0ZXJzLCBjdXN0b21GaWx0ZXJzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB1cmxfcGFyYW1zW21hcHBpbmdzLnBhZ2VdID0gZ3JpZC5wYWdpbmF0aW9uLnBhZ2U7XHJcbiAgICAgICAgICAgICAgICB1cmxfcGFyYW1zW21hcHBpbmdzLnBlclBhZ2VdID0gZ3JpZC5wYWdpbmF0aW9uLnBlclBhZ2U7XHJcbiAgICAgICAgICAgICAgICB1cmxfcGFyYW1zW21hcHBpbmdzLmRpcmVjdGlvbl0gPSBncmlkLnNvcnQuZGlyZWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgdXJsX3BhcmFtc1ttYXBwaW5ncy5vcmRlcl0gPSBncmlkLnNvcnQuZmllbGQ7XHJcbiAgICAgICAgICAgICAgICB1cmxfcGFyYW1zW21hcHBpbmdzLmZpbHRlcnNdID0gbmcudG9Kc29uKGZpbHRlcnMpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzdGF0aWNQYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZy5leHRlbmQodXJsX3BhcmFtcywgc3RhdGljUGFyYW1zKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdXJsX3BhcmFtcztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZmlsdGVyKGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpc1N1Ym1pdHRhYmxlRXZlbnQoZSkgJiYgIWdyaWQubG9hZGluZykge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5zY29wZS4kYnJvYWRjYXN0KGV2ZW50cy5maWx0ZXJzQ2hhbmdlZCwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzOiBncmlkLmZpbHRlcnMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGdyaWQubmFtZVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5wYWdpbmF0ZShldmVudHMuZmlsdGVyc0NoYW5nZWQsIHsnZXZlbnQnOiBlLCBmaWx0ZXJzOiBncmlkLmZpbHRlcnMsIGdyaWQ6IGdyaWQubmFtZX0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBjbGVhckZpbHRlcnMoZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzU3VibWl0dGFibGVFdmVudChlKSAmJiAhZ3JpZC5sb2FkaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JpZC5maWx0ZXJzID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyKGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBfb25HcmlkRXh0ZXJuYWxseUNoYW5nZWQoZSwgZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEubmFtZSA9PT0gcGFyYW1zLm5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZy5mb3JFYWNoKGRhdGEsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdmaWx0ZXJzJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpbHRlcnMgPSBPYmplY3Qua2V5cyhncmlkW2tleV0pLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0ZpbHRlcnMgPSBPYmplY3Qua2V5cyh2YWx1ZSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlmZiA9IGZpbHRlcnMuZGlmZihuZXdGaWx0ZXJzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaWZmLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZGVsZXRlZCBpbiBkaWZmKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlmZi5oYXNPd25Qcm9wZXJ0eShkZWxldGVkKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBncmlkW2tleV1bZGlmZltkZWxldGVkXV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5nLmlzT2JqZWN0KHZhbHVlKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5nLmZvckVhY2godmFsdWUsIGZ1bmN0aW9uIChwcm9wLCBpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5nLmlzU3RyaW5nKHByb3ApKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkW2tleV1baV0gPSBwcm9wO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKG5nLmlzU3RyaW5nKHZhbHVlKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRba2V5XSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBfd2F0Y2hHcmlkU29ydChuLCBvKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNPcmRlckNoYW5nZWQobiwgbykpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZy5leHRlbmQobiwge25hbWU6IGdyaWQubmFtZX0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5zY29wZS4kYnJvYWRjYXN0KGV2ZW50cy5zb3J0Q2hhbmdlZCwgbik7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLnBhZ2luYXRlKGV2ZW50cy5zb3J0Q2hhbmdlZCwgeyduZXcnOiBuLCAnb2xkJzogb30pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBfd2F0Y2hHcmlkUGFnaW5hdGlvbihuLCBvKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNQYWdlQ2hhbmdlZChuLCBvKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5nLmV4dGVuZChuLCB7bmFtZTogZ3JpZC5uYW1lfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLnNjb3BlLiRicm9hZGNhc3QoZXZlbnRzLnBhZ2luYXRpb25DaGFuZ2VkLCBuKTtcclxuICAgICAgICAgICAgICAgICAgICBwYXJhbXMucGFnaW5hdGUoZXZlbnRzLnBhZ2luYXRpb25DaGFuZ2VkLCB7J25ldyc6IG4sICdvbGQnOiBvfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIF93YXRjaEdyaWRGaWx0ZXJzKG4sIG8pIHtcclxuICAgICAgICAgICAgICAgIGlmIChjcmlwR3JpZENvbmZpZy51cGRhdGVPbkZpbHRlckNoYW5nZSAmJiAhbmcuZXF1YWxzKG4sIG8pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBwcmVwYXJlRmlsdGVycyhmaWx0ZXJzKSB7XHJcbiAgICAgICAgICAgIHZhciByZXQgPSBbXTtcclxuICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGZpbHRlcnMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJzLmhhc093blByb3BlcnR5KGtleSkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXQucHVzaChba2V5LCBmaWx0ZXJzW2tleV1dKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNTdWJtaXR0YWJsZUV2ZW50KGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBldmVudCA9PT0gdHJ1ZSB8fFxyXG4gICAgICAgICAgICAgICAgZXZlbnQudHlwZSA9PT0gJ2NsaWNrJyB8fCBldmVudC50eXBlID09PSAnc3VibWl0JyB8fFxyXG4gICAgICAgICAgICAgICAgKCBldmVudC50eXBlID09PSAna2V5cHJlc3MnICYmIGV2ZW50LmtleUNvZGUgPT09IDEzICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc1BhZ2VDaGFuZ2VkKG4sIG8pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG4gIT09IG8gJiYgKHBhcnNlSW50KG4ucGFnZSkgIT09IHBhcnNlSW50KG8ucGFnZSkgfHwgcGFyc2VJbnQobi5wZXJQYWdlKSAhPT0gcGFyc2VJbnQoby5wZXJQYWdlKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc09yZGVyQ2hhbmdlZChuLCBvKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuICE9PSBvICYmIChuLmRpcmVjdGlvbiAhPT0gby5kaXJlY3Rpb24gfHwgbi5maWVsZCAhPT0gby5maWVsZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KShhbmd1bGFyLCBPYmplY3QsIHdpbmRvdy5jcmlwIHx8ICh3aW5kb3cuY3JpcCA9IHt9KSk7IiwiKGZ1bmN0aW9uIChuZywgY3JpcCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGNyaXAuZ3JpZFxyXG4gICAgICAgIC5wcm92aWRlcignY3JpcEdyaWRDb25maWcnLCBjcmlwR3JpZENvbmZpZyk7XHJcblxyXG4gICAgY3JpcEdyaWRDb25maWcuJGluamVjdCA9IFtdO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNyaXBHcmlkQ29uZmlnKCkge1xyXG4gICAgICAgIHZhciBwbHVnaW5zID0ge30sXHJcbiAgICAgICAgICAgIHJlcXVlc3RfcHJvcHMgPSBzZXRSZXF1ZXN0TWFwcGluZ3MoKSxcclxuICAgICAgICAgICAgZGVmYXVsdF9wZXJfcGFnZSA9IDEwLFxyXG4gICAgICAgICAgICBwZXJfcGFnZSA9IFsxMCwgMjUsIDUwXTtcclxuXHJcbiAgICAgICAgdmFyIHNjb3BlID0gdGhpcztcclxuXHJcbiAgICAgICAgbmcuZXh0ZW5kKHNjb3BlLCB7XHJcbiAgICAgICAgICAgIGdldFBsdWdpbnM6IGdldFBsdWdpbnMsXHJcbiAgICAgICAgICAgIHNldFBsdWdpbnM6IHNldFBsdWdpbnMsXHJcbiAgICAgICAgICAgIGdldFJlcXVlc3RNYXBwaW5nczogZ2V0UmVxdWVzdE1hcHBpbmdzLFxyXG4gICAgICAgICAgICBzZXRSZXF1ZXN0TWFwcGluZ3M6IHNldFJlcXVlc3RNYXBwaW5ncyxcclxuICAgICAgICAgICAgc2V0UGVyUGFnZU9wdGlvbnM6IHNldFBlclBhZ2VPcHRpb25zLFxyXG4gICAgICAgICAgICB1cGRhdGVPbkZpbHRlckNoYW5nZTogZmFsc2VcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy4kZ2V0ID0gWyRnZXRdO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiAkZ2V0KCkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZ2V0UGx1Z2luczogZ2V0UGx1Z2lucyxcclxuICAgICAgICAgICAgICAgIGdldFJlcXVlc3RNYXBwaW5nczogZ2V0UmVxdWVzdE1hcHBpbmdzLFxyXG4gICAgICAgICAgICAgICAgZ2V0UGVyUGFnZU9wdGlvbnM6IGdldFBlclBhZ2VPcHRpb25zLFxyXG4gICAgICAgICAgICAgICAgZ2V0RGVmYXVsdFBlclBhZ2VPcHRpb246IGdldERlZmF1bHRQZXJQYWdlT3B0aW9uLFxyXG4gICAgICAgICAgICAgICAgdXBkYXRlT25GaWx0ZXJDaGFuZ2U6IHNjb3BlLnVwZGF0ZU9uRmlsdGVyQ2hhbmdlXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRQbHVnaW5zKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcGx1Z2lucztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldFBsdWdpbnMobmV3UGx1Z2luQ29uZmlnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwbHVnaW5zID0gbmcuY29weShuZXdQbHVnaW5Db25maWcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0UmVxdWVzdE1hcHBpbmdzKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVxdWVzdF9wcm9wcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldFJlcXVlc3RNYXBwaW5ncyhwYWdlLCBwZXJQYWdlLCBkaXJlY3Rpb24sIG9yZGVyLCBmaWx0ZXJzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXF1ZXN0X3Byb3BzID0ge1xyXG4gICAgICAgICAgICAgICAgcGFnZTogcGFnZSB8fCAncGFnZScsXHJcbiAgICAgICAgICAgICAgICBwZXJQYWdlOiBwZXJQYWdlIHx8ICdwZXItcGFnZScsXHJcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb246IGRpcmVjdGlvbiB8fCAnZGlyZWN0aW9uJyxcclxuICAgICAgICAgICAgICAgIG9yZGVyOiBvcmRlciB8fCAnb3JkZXInLFxyXG4gICAgICAgICAgICAgICAgZmlsdGVyczogZmlsdGVycyB8fCAnZmlsdGVycydcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFBlclBhZ2VPcHRpb25zKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcGVyX3BhZ2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXREZWZhdWx0UGVyUGFnZU9wdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRfcGVyX3BhZ2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXRQZXJQYWdlT3B0aW9ucyhwZXJfcGFnZV9vcHRpb25zKSB7XHJcbiAgICAgICAgICAgIGlmIChuZy5pc0FycmF5KHBlcl9wYWdlX29wdGlvbnMpICYmIHBlcl9wYWdlX29wdGlvbnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdF9wZXJfcGFnZSA9IHBlcl9wYWdlX29wdGlvbnNbMF07XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcGVyX3BhZ2UgPSBwZXJfcGFnZV9vcHRpb25zO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigncGVyX3BhZ2Vfb3B0aW9ucyBjYW4gYmUgYXJyYXkgZnJvbSBpbnRlZ2VycycpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoYW5ndWxhciwgd2luZG93LmNyaXAgfHwgKHdpbmRvdy5jcmlwID0ge30pKTsiLCJhbmd1bGFyLm1vZHVsZShcImNyaXAuZ3JpZC50ZW1wbGF0ZXNcIiwgW10pLnJ1bihbXCIkdGVtcGxhdGVDYWNoZVwiLCBmdW5jdGlvbigkdGVtcGxhdGVDYWNoZSkgeyR0ZW1wbGF0ZUNhY2hlLnB1dChcIi9jcmlwL2dyaWQvcGFnaW5hdGlvbi5odG1sXCIsXCI8dWwgY2xhc3M9XFxcInBhZ2luYXRpb25cXFwiPlxcclxcbiAgICA8bGkgbmctaWY9XFxcIjo6Ym91bmRhcnlMaW5rc1xcXCJcXHJcXG4gICAgICAgIG5nLWNsYXNzPVxcXCJ7ZGlzYWJsZWQ6IG5vUHJldmlvdXMoKX1cXFwiXFxyXFxuICAgICAgICBjbGFzcz1cXFwicGFnaW5hdGlvbi1maXJzdFxcXCI+XFxyXFxuICAgICAgICA8YSBocmVmIG5nLWNsaWNrPVxcXCJzZWxlY3RQYWdlKDEsICRldmVudClcXFwiPnt7OjpnZXRUZXh0KFxcJ2ZpcnN0XFwnKX19PC9hPlxcclxcbiAgICA8L2xpPlxcclxcblxcclxcbiAgICA8bGkgbmctaWY9XFxcIjo6ZGlyZWN0aW9uTGlua3NcXFwiXFxyXFxuICAgICAgICBuZy1jbGFzcz1cXFwie2Rpc2FibGVkOiBub1ByZXZpb3VzKCl9XFxcIlxcclxcbiAgICAgICAgY2xhc3M9XFxcInBhZ2luYXRpb24tcHJldlxcXCI+XFxyXFxuICAgICAgICA8YSBocmVmIG5nLWNsaWNrPVxcXCJzZWxlY3RQYWdlKGNyaXBHcmlkUGFnaW5hdGlvbi5wYWdlIC0gMSwgJGV2ZW50KVxcXCI+e3s6OmdldFRleHQoXFwncHJldmlvdXNcXCcpfX08L2E+XFxyXFxuICAgIDwvbGk+XFxyXFxuXFxyXFxuICAgIDxsaSBuZy1yZXBlYXQ9XFxcInBhZ2UgaW4gcGFnZXNcXFwiXFxyXFxuICAgICAgICBuZy1jbGFzcz1cXFwie2FjdGl2ZTogcGFnZS5hY3RpdmV9XFxcIlxcclxcbiAgICAgICAgY2xhc3M9XFxcInBhZ2luYXRpb24tcGFnZVxcXCI+XFxyXFxuICAgICAgICA8YSBocmVmIG5nLWNsaWNrPVxcXCJzZWxlY3RQYWdlKHBhZ2UubnVtYmVyLCAkZXZlbnQpXFxcIj57e3BhZ2UudGV4dH19PC9hPlxcclxcbiAgICA8L2xpPlxcclxcblxcclxcbiAgICA8bGkgbmctaWY9XFxcIjo6ZGlyZWN0aW9uTGlua3NcXFwiXFxyXFxuICAgICAgICBuZy1jbGFzcz1cXFwie2Rpc2FibGVkOiBub05leHQoKX1cXFwiXFxyXFxuICAgICAgICBjbGFzcz1cXFwicGFnaW5hdGlvbi1uZXh0XFxcIj5cXHJcXG4gICAgICAgIDxhIGhyZWYgbmctY2xpY2s9XFxcInNlbGVjdFBhZ2UoY3JpcEdyaWRQYWdpbmF0aW9uLnBhZ2UgKyAxLCAkZXZlbnQpXFxcIj57ezo6Z2V0VGV4dChcXCduZXh0XFwnKX19PC9hPlxcclxcbiAgICA8L2xpPlxcclxcblxcclxcbiAgICA8bGkgbmctaWY9XFxcIjo6Ym91bmRhcnlMaW5rc1xcXCJcXHJcXG4gICAgICAgIG5nLWNsYXNzPVxcXCJ7ZGlzYWJsZWQ6IG5vTmV4dCgpfVxcXCJcXHJcXG4gICAgICAgIGNsYXNzPVxcXCJwYWdpbmF0aW9uLWxhc3RcXFwiPlxcclxcbiAgICAgICAgPGEgaHJlZiBuZy1jbGljaz1cXFwic2VsZWN0UGFnZShjcmlwR3JpZFBhZ2luYXRpb24udG90YWxQYWdlcywgJGV2ZW50KVxcXCI+e3s6OmdldFRleHQoXFwnbGFzdFxcJyl9fTwvYT5cXHJcXG4gICAgPC9saT5cXHJcXG48L3VsPlwiKTtcbiR0ZW1wbGF0ZUNhY2hlLnB1dChcIi9jcmlwL2dyaWQvcGVyLXBhZ2UuaHRtbFwiLFwiPHNwYW4gbmctdHJhbnNjbHVkZT48L3NwYW4+XFxyXFxuPHNlbGVjdCBjbGFzcz1cXFwiYy1wZXItcGFnZSBmb3JtLWNvbnRyb2wge3tjcmlwQ2xhc3N9fVxcXCJcXHJcXG4gICAgICAgIG5nLW1vZGVsPVxcXCJzZWxlY3RlZFxcXCJcXHJcXG4gICAgICAgIG5nLW9wdGlvbnM9XFxcInNpemUgYXMgc2l6ZSBmb3Igc2l6ZSBpbiBvcHRpb25zXFxcIj48L3NlbGVjdD5cIik7XG4kdGVtcGxhdGVDYWNoZS5wdXQoXCIvY3JpcC9ncmlkL3RoLmh0bWxcIixcIjxhIGhyZWYgdGl0bGU9XFxcInt7Y3JpcFRpdGxlfX1cXFwiXFxyXFxuICAgbmctY2xpY2s9XFxcImNyaXBHcmlkVGguc29ydEJ5KGNyaXBOYW1lKVxcXCI+XFxyXFxuICAgIDxpIGNsYXNzPVxcXCJjcmlwLWljb24gZmEgcHVsbC1yaWdodFxcXCJcXHJcXG4gICAgICAgbmctY2xhc3M9XFxcIntcXCdmYS1zb3J0LWRlc2NcXCc6IGNyaXBHcmlkVGguaXNEZXNjRm9yKGNyaXBOYW1lKSxcXHJcXG4gICAgICAgICAgICAgICAgICBcXCdmYS1zb3J0LWFzY1xcJzogY3JpcEdyaWRUaC5pc0FzY0ZvcihjcmlwTmFtZSl9XFxcIj48L2k+IDxzcGFuIG5nLXRyYW5zY2x1ZGU+PC9zcGFuPlxcclxcbjwvYT5cIik7fV0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
